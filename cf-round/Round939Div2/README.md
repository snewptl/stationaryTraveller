# 本场摘要

这一场无功无过，rank 为 411，rating 加了 55，来到了 1889。比赛时通过了 ABCD 四个题目。

感觉这一场题目难度在中等偏上，思路上虽然非常清晰直接，但是实现难度比一般场次大。E、F 题的 idea 较为新颖，作为拓展思路的场次还是很不错的。出题老哥是个华南师范大学附属中学的初三学生~~这么小就是红名了，反观我这个老古董却越来越菜了。。。~~，不得不说出题水平相当可以。

这一场的 D 题很早就有了 idea，但是写的时候非常坎坷，先是 DP 写错调半天，然后再是递归写挂。。。可见退役久了水平下降得十分明显——放在本科的时候应该能 1h 内写完前四个题的。。。不过这也是应该的，毕竟很久没有系统训练过了，以后想上分还是得多多补题。天天空想着上个红名，不脚踏实地是不可能的。

这两天几乎听完了肖斯塔科维奇的弦乐四重奏，然后又在B站上看了很多他的故事，发现天才如他其实也是位卷王，在圣彼得堡音乐学院读书的时候几乎门门功课都卷到了 5 分。既然我只是一个普通人，要做成事情需要更加努力才是，继续加油吧。

**传送门：**

[题目](https://codeforces.com/contest/1956)

[博客中的题解（推荐）](http://snewptl.com/2024/03/31/Codeforces-Round939Div2/)

# C. 

**题目大意：**

给出一个大小为 $n * n$ 的方阵，方阵的每个位置上都是 0。题目定义了两种操作：
+ 操作一，把一行中的所有数字变成一个大小为 n 的排列，排列的顺序可以自定义。
+ 操作二，把一列中的所有数字变成一个大小为 n 的排列，排列的顺序可以自定义。

要求最多进行 $2 * n$ 此操作，要求使得最后的结果方阵中，每个位置上的数字之和最大。

**题解：**

构造题虽然变化万千，但是还是有一定套路的。一般来说，拿到问题后先构造找出理论最大值，一般来说这种情况是有对应解的，然后我们再去构造这个解。

观察可知，一个相同的数字，不能同时出现在一个矩形的四个顶点的位置上。既不存在这样的四个点 $(i, j), (i, j + m), (i + n, j), (i + n, j + m)$ 上的值相等。所以一个数字在方阵中最多出现 $2 * n - 1$ 次，即反“L 型”地排列在方阵的右下角。大的数字肯定要出现尽量多次，所以越大的数字要约放在右下。形如（以 $n = 4$ 为例）：

1 2 3 4
2 2 3 4
3 3 3 4
4 4 4 4 

在想出构造的期望样式后，我们就能有的放矢了。先放最后一行，排列为 $1, 2, ..., n$，然后是倒数第二行和倒数第二列，排列依然是 $1, 2, ..., n$。这样一直做下去，直到放完第一行和第一列，总共操作 $2n - 1$ 次。

# D. 

**题目大意：**

题目给定一个大小为 n 的整数序列，其中 $n \leq 18$。每次操作可以选择一个 $[l, r]$ 的区间，然后将这个区间中的整数变成 $Mex(l, r)$，$Mex(l, r)$ 定义为「区间中最小的未出现的非负整数」。可以进行不限次这样的操作，要求使得最后的整数序列和最大，并输出构造出该序列过程中选取的一系列区间

**题解：**

考虑一个长度为 m 的初始全为 0 的区间，经过观察可知，题目中定义的构造后最大的可能结果就是区间的数字全部变为 m（可以从从 $m = 1$，$m = 2$ 等大概递推出任意长区间的构造方式）。

这样一来，问题就分成了两个部分，第一部分是将原序列划分成若干个区间，对于一个长度为 m 的区间，其内部可以全部变成数字 m，也可以保持原状，要使得结果最大；第二部分是给定一个长度为 m 的区间，将区间中的所有数字变成 m。

前者是一个非常经典的区间DP，后者显然需要递归实现。这道题的解法非常清晰直观，剩下的就是手速的比拼了。

# E. 

**题目大意：**

给定长度为 n 的一个序列 a。从前往后，从 $i = 1$ 开始，让 $a_{i + 1} = \max\left\{a_{i + 1} - a_i, 0\right\}$。i 的取值依次递增，当 $i = n$ 时，使 $a_1 = \max\left\{a_1 - a_n, 0\right\}$，然后再让 $i = 1$。如此循环往复，无限次地操作下去。直到这样的操作不能让序列中的元素产生变化。求最后“尘埃落定”后的序列中所有不为零的元素的下标。

**题解：**

显然，操作的次数最多能达到 Int32 次。例如仅有三个元素的序列：$0, 1, 1e9$。问题到这里似乎就走进了死胡同，因为如果序列短一点还好说，可以构造式子求解，但是面对大小为 n 的序列，除了暴力模拟就别无他法了——于是尝试分析这个序列的性质，我们可以发现，如果一个数字前面的连续非零数字越多，它被减的值的数量级就会越大。

例如，假设序列为 $0, a_1, a_2, a_3, ...$。经过 m 轮操作后，假设 $a_2, a_3$ 仍非 0，不妨设 $a_2 % a_1 = 0$，那么新的序列为$0, a_1, a_2 - a_1 * n, a_3 - (a_2 * 2 - a_1 * (n + 1)) * n / 2, ...$。观察到 $a_3$ 减少值比 $a_2$ 大了至少 $O(n)$ 倍。

所以经过至多 $1e9^{\frac{1}{3}}$ 轮后，则原序列的连续非零子串长度最大为 3。

发现这个性质之后，这个题就完全没有思维难度了，只需要暴力计算后，把原序列划分成若干个子序列，然后分别求解即可。但是这道题实现过程较为繁琐，且在 E2 进行了卡常，即使是 std 的耗时也来到了 1000ms 左右，而笔者实现的代码会在 E2 的第 22 个点 TLE。。。

# F. 

**题目大意：**

操场上 n 个学生站成一排（其中 $n \leq 1e6$），每个学生有一个抛球的力度区间 $[l_i, r_i]$，对于两个学生 i 和 j 而言，如果满足 $|i - j| < [l_i + l_j, r_i + r_j]$，则 i 和 j 可以互相抛球。体育老师在一次活动开始时，可以给某个同学一个球，然后这个同学再传给其他同学，每个同学只要能接到球，就可以传给其他人或者扔掉这个球，且每个人在单次活动中可以接球多次。体育老师在下课后还有一个约会，很赶时间，所以期望能通过尽量少次的活动，让每个同学都能至少接到一次球。问这样的活动至少需要多少次。

**题解：**

说来惭愧，拿到这道题后我几乎是直奔题解，根本没指望能自己想出来。但看完题解后发现其实也不是“不可做”，甚至说是一个很经典的前缀建边。如果是初见这类题目的话，参考价值非常大。即使是知道题解，我在实现的过程成依然花费了不小的功夫。

言归正传，琢磨这道题目的条件，看到“一个同学可以接球多次”，“$|i - j| < [l_i + l_j, r_i + r_j]$”的字眼，容易联想到利用图的联通性，然后加点连边。~~显然，这是开了“上帝视角”的马后炮。。。乐~~

对于那个看起来非常怪异的不等式条件，有一个很合乎直觉的理解方法，即：我们可以把 $[i + l_i, i + r_i]$ 看作是 i 同学的“右手”，把 $[i - r_i, i - l_i]$ 看作是 i 同学的“左手”。不妨设 $i < j$，如果满足 $[i + l_i, i + r_i] \cap [j - r_j, j - l_j] \neq \varnothing$，则说明能 i 同学和 j 同学能相互通过右手拉左手的方式够到彼此。

每个学生都可以看成是白点，然后再构造 n 个黑点来表示每个坐标，如果一个学生 i 的手能伸到点 x，则在白点 i 和黑点 x 之间连一条边。即：如果满足 $x \in [i - r_i, i - l_i] \lor x \in [i + l_i, i + r_i]$，则连接 i 和 x。

但是我们仍然会面临两个问题：
+ 可能会存在两个学生同时用左手拉左手，或者右手拉右手，这样是不符合不等式约束要求的。
+ 上述的解法显然要加 $O(n^2)$ 条边，在 n 如此巨大的情况下，明显无法通过题目。

对于问题一，我们可以注意到这样一条性质，如果有若干个学生能够到同一个点，且满足这些学生中既有使用左手的，也有使用右手的，那么这些学生一定能在一次传球活动中同时接到球——比如，可以选定某个使用右手的学生作为支点，在使用左手的学生之间来回传球，这样就能遍历完这个点相连的所有使用左手的学生（右手亦然）。假如一个点 x 上连接的只有都使用左手（右手）的学生，那我们就舍弃掉这个点，则问题解决。

对于问题二，假如一个学生的左（右）手能够到区间 $[i, j]$，其实不必对区间内每个点都连边，可以仅连到 i 点，然后再依次连接 $(i, i + 1), (i + 1, i + 2), ..., (j - 1, j)$。这样下来总的连边数是 $n + n - 1$，即可通过题目。

笔者写的代码一直收到 WA，且对比 std 后发现写的十分臃肿，所以这里建议直接看 std。















