# 本场摘要

**传送门：**

[题目](https://codeforces.com/contest/1925)

[本人博客中的题解（推荐）](http://snewptl.com/2024/02/07/Codeforces-Round921Div2/)



这场总体难度较小，没有很难的题目。但是会在刁钻的地方恶心人，也许是出题的印度老哥故意设计的。。。总之题目出得非常奇怪，不过作为复健场来说也还算有练习的价值。

总体做下来体验有点差——特别是最后的F题。幸好只是拿来训练，不然参赛的话可能会一直WA。


# D. Good Trip

**题目大意：**

在$n$个元素中等可能地选取两个元素，选完后放回，等可能地选$m$轮。每对元素可能是朋友或不是朋友，如果是朋友则对应的“友好值”为一个整数。每当一对元素被选中后，如果这对元素是“朋友”，则会将该友好值加到$sum$中，并且其“友好值”会$+1$。问最终$sum$期望多大。

**题解：**

将$sum$分成两部分，即「基础部分」和「增加的部分」。

「基础部分」是很显然的：
$$
k * \frac{\sum_{i=1}^m f_i}{C_n^2}
$$

「增加部分」稍微有些棘手。可以注意到，如果只考虑增加值的话，每对朋友都是等价的，所以只要算出一对朋友的贡献，最后乘以朋友对数就行了。
而在增加值中，一对朋友的贡献仅与其被抽到的次数有关，对于每一对朋友，遍历其被抽到1...k次时产生的贡献然后加起来即可：
$$
m * \sum_{i=1}^k C_k^i * \frac{i *(i-1)}{2} *\left(\frac{1}{C_n^2}\right)^i *\left(1-\frac{1}{C_n^2}\right)^{k-i}
$$

# E. Space Harbour


**题目大意：**

在数轴上有 1...n 总共 $n$ 个点，每个点上都有一艘飞船。在数轴中一些harbour，分散在数轴的 $m$ 个位置上，每个harbour有一个对应的value。一个飞船的弹射起飞的花销是其「左边最近的harbour的value」乘以「右侧最近harbour与当前飞船的距离」。

有两种操作，一种操作是在数轴中一个地方增加一个harbour；另一种操作是查询一段区间内所有飞船起飞花销的总和。

**题解：**

一眼线段树，带加法和乘法两种操作，然后记得带上懒标记即可。虽然思路十分清晰，但是写起来还是蛮麻烦的，个人觉得出题人的方法写起来更简单，不过他的代码风格相当难绷。。。

注意不要爆int32。其他的细节看代码实现和注释即可。

# F. Fractal Origami

**题目大意：**

有一张边长为 $1$ 的正方形折纸，将对其进行 $N$ 次操作。

每次操作为：首先选择每条边的中点，并顺次将其连起来，得到四条边。分别沿着这四条边，将正方形的每个角折起来。每经过一次操作后，会得到一个新的正方形，其边长为原来的 $\frac{1}{\sqrt{2}}$

操作完后，重新展开这张折纸，折痕中有凸起来（“峰”）的也有凹下去（“谷”）的。

求“峰”的长度除以“谷”的长度的结果中，$\sqrt{2}$ 的系数。

**题解：**

假设一张纸朝上的是正面，朝下的是反面。显然，纸张朝上的时候对折起来，折痕是凹的；纸张朝下时对折起来，折痕的凸的。

在第一次对折的时候，可以注意到底部依然是一个正面朝上的边长为 $\frac{1}{\sqrt{2}}$ 的纸，上方的四个角我们可以把它看作一个整体，形成了一个边长同样为 $\frac{1}{\sqrt{2}}$ 的正方形。

第二次对折后，整张纸变成了四层。下面的两层是一反一正的，上面的两层同样是一反一正。

第三次对折后，整张纸变成了八层。下面的四层是一反一正一反一正的，上面的四层同样是一反一正一反一正。

etc...

用式子总结一下，设“峰”的总长度为 $Sum_{peak}$，

$$
\begin{aligned}
\operatorname{Sum}_{peak} & =4 * \sum_{i=2}^n \frac{1}{(\sqrt{2})^2} * 2^{n-2} \\
& =4 * \sum_{i=2}^n(\sqrt{2})^{n-4} \\
& =\frac{1-(\sqrt{2})^{n-1}}{1-\sqrt{2}} * 2
\end{aligned}
$$

设“谷”的总长度为 $Sum_{valley}$，则：

$$
\begin{aligned}
\operatorname{Sum}_{valley} & =4 *\left(\sum_{i=2}^n \frac{1}{(\sqrt{2})^n} * 2^{n-2}+\frac{1}{\sqrt{2}}\right) \\
& =4 *\left[\sum_{i=2}^n(\sqrt{2})^{n-4}+\frac{1}{\sqrt{2}}\right] \\
& =\frac{1-(\sqrt{2})^{n-1}}{1-\sqrt{2}} * 2+2 \sqrt{2}
\end{aligned}
$$

由于直接算“峰”除以”谷“有点难算——因为”谷“包含了更多的项，于是我们先用”谷“除以”峰“，得到

$$
\frac{\sqrt{2}-1-(\sqrt{2})^{n-1}}{1-(\sqrt{2})^{n-1}}
$$

分母有理化，得到

$$
\frac{\sqrt{2}+(\sqrt{2})^n-1-(\sqrt{2})^{n+1}-2^{n-1}}{1-2^{n-1}}
$$

这个式子可以写成如下形式
$$
A+B \sqrt{2}
$$

这个式子显然是我们期望式子的倒数，即
$$
\frac{1}{A+B \sqrt{2}}=\frac{A-B \sqrt{2}}{A^2-2 B^2}
$$

所以我们需要的 $\sqrt{2}$ 的系数即为
$$
\frac{-B}{A^2-2 B^2}
$$

这道题目还有一个极其恶心的地方，就是其中的一个计算步骤中出现了 $\frac{1}{2^{n-1}-1}$ ，如果对 $2^{n-1}-1$ 求逆元的话，由于模数是 $999999893$，根据费马小定理，这个式子会在 $n = 999999893$ 的时候变成 $0$，导致结果出错。所以得对这种情况特判断，换一下计算方式。不得不说,如果在比赛的途中遇到这个问题，真的很让人心态爆炸。

